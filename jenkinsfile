pipeline {
    agent any
     //tools {
        // Define JDK tool installation
       // jdk 'JDK 11'
    //}

    environment {
            DOCKER_REGISTRY_CREDENTIALS = credentials('dockerhub') // This assumes you've set up Jenkins credentials for your Docker registry
            DOCKER_IMAGE_NAME = 'hemu369/spring-boot-demo/spring-image-1'
            REMOTE_SERVER_USERNAME = 'ubuntu'
            REMOTE_SERVER_ADDRESS = '18.217.76.208'
        }
    
    stages {
        
        stage('Build') {
            steps {
                // Build your Spring Boot application
                dir('csc') {
                sh "mvn clean install" // Assuming you're using Maven for your build
                }
            }
        }

        stage('Docker Build and Push') {
                    steps {
                        // Build Docker image
                        script {
                            docker.build(env.DOCKER_IMAGE_NAME)
                        }
                        // Log in to Docker registry
                        withCredentials([usernamePassword(credentialsId: env.DOCKER_REGISTRY_CREDENTIALS, passwordVariable: 'Ravipati@99', usernameVariable: 'hemu369')]) {
                            script {
                                docker.withRegistry('https://registry.hub.docker.com', env.DOCKER_USERNAME, env.DOCKER_PASSWORD) {
                                    // Push Docker image to registry
                                    docker.image(env.DOCKER_IMAGE_NAME).push()
                                }
                            }
                        }
                    }
                }
        
        stage('Deploy') {
            steps {
                // Copy your built artifact to the EC2 instance
                //sh 'scp target/your-application.jar ec2-user@your_ec2_instance_public_ip:/path/to/deployment/directory'
                echo('deployment')
                // Restart your application on EC2 (you may need to replace this with appropriate commands)
                //sh 'ssh ec2-user@your_ec2_instance_public_ip "sudo systemctl restart your-application.service"'
            }
        }
    }
}
